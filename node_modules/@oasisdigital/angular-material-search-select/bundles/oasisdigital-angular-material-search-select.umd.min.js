!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@angular/material"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@oasisdigital/angular-material-search-select",["exports","@angular/core","@angular/common","@angular/forms","@angular/material","rxjs","rxjs/operators"],e):e(((t=t||self).oasisdigital=t.oasisdigital||{},t.oasisdigital["angular-material-search-select"]={}),t.ng.core,t.ng.common,t.ng.forms,t.ng.material,t.rxjs,t.rxjs.operators)}(this,function(t,e,n,o,i,r,a){"use strict";var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};var c=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function u(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)a.push(o.value)}catch(s){i={error:s}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}return a}var h=function(){function t(){var t=this;this.debounceTime=75,this.searchControl=new o.FormControl,this.incomingValues=new r.Subject,this.incomingDataSources=new r.BehaviorSubject({displayValue:r.of,search:function(){return r.of([])}}),this.onChange=function(t){},this.onTouched=function(){};var e=this.searchControl.valueChanges.pipe(a.startWith(this.searchControl.value),a.distinctUntilChanged(),a.debounce(function(e){return"string"==typeof e?r.timer(t.debounceTime):r.EMPTY})),n=r.combineLatest(e,this.incomingDataSources.pipe(a.filter(function(t){return!!t}))).pipe(a.switchMap(function(t){var e=p(t,2),n=e[0],o=e[1];if(null===n&&(n=""),"string"==typeof n){var i=n;return o.search(n).pipe(a.map(function(t){return{search:i,list:t}}),a.catchError(function(t){return r.of({search:i,errorMessage:t})}),a.startWith({search:i}))}var s=n;return r.of({search:n.display,list:[c({},s)]})}),a.publishReplay(1),a.refCount());function i(t,e){return e.display===t}this.selectedValue=n.pipe(a.filter(function(t){return!!t.list}),a.withLatestFrom(this.incomingDataSources),a.map(function(t){var e=p(t,2),n=e[0],o=e[1],r=n.list||[],a=o.match||i,s=r.find(function(t){return a(n.search,t)});return s&&s.value||null}),a.distinctUntilChanged()),this.loading=n.pipe(a.map(function(t){return!t.list&&!t.errorMessage})),this.list=n.pipe(a.map(function(t){return t.list})),this.empty=n.pipe(a.map(function(t){return!!t.list&&0===t.list.length})),this.errorMessage=n.pipe(a.map(function(t){return t.errorMessage})),this.incomingDataSourcesSub=this.incomingValues.pipe(a.withLatestFrom(this.incomingDataSources),a.switchMap(function(t){var e=p(t,2),n=e[0];return e[1].displayValue(n)})).subscribe(function(e){return t.searchControl.setValue(e)})}return Object.defineProperty(t.prototype,"dataSource",{set:function(t){this.incomingDataSources.next(t)},enumerable:!0,configurable:!0}),t.prototype.focus=function(){this.selectedValueSub=this.selectedValue.subscribe(this.checkAndPropagate.bind(this))},t.prototype.blur=function(){this.onTouched(),this.selectedValueSub&&this.selectedValueSub.unsubscribe(),this.selectedValue.pipe(a.take(1)).subscribe(this.checkAndPropagate.bind(this))},t.prototype.displayWith=function(t){return t?t.display:""},t.prototype.writeValue=function(t){t!==this.outsideValue&&(this.outsideValue=t,this.incomingValues.next(t))},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.setDisabledState=function(t){t?this.searchControl.disable():this.searchControl.enable()},t.prototype.ngOnDestroy=function(){this.incomingDataSourcesSub&&this.incomingDataSourcesSub.unsubscribe()},t.prototype.checkAndPropagate=function(t){t!==this.outsideValue&&(this.outsideValue=t,this.onChange(t))},u([e.Input(),l("design:type",Object)],t.prototype,"debounceTime",void 0),u([e.Input(),l("design:type",Object),l("design:paramtypes",[Object])],t.prototype,"dataSource",null),t}(),f=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.debounceTime=100,e.width="",e.emptyText="",e.autoActiveFirstOption=!1,e}var i;return function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(n,t),i=n,u([e.Input(),l("design:type",String)],n.prototype,"placeholder",void 0),u([e.Input(),l("design:type",Object)],n.prototype,"debounceTime",void 0),u([e.Input(),l("design:type",Object)],n.prototype,"width",void 0),u([e.Input(),l("design:type",Object)],n.prototype,"emptyText",void 0),u([e.Input(),l("design:type",Object)],n.prototype,"autoActiveFirstOption",void 0),n=i=u([e.Component({selector:"search-select",template:'<mat-form-field class="obs-mat-container" [style.width]="width">\n  <mat-spinner class="obs-mat-spinner"\n    *ngIf="loading | async"\n    [diameter]="20"\n    [strokeWidth]="5"></mat-spinner>\n  <i class="obs-no-matches" *ngIf="emptyText && empty | async">{{emptyText}}</i>\n  <input\n      type="text"\n      [placeholder]="placeholder"\n      [attr.aria-label]="placeholder"\n      spellcheck="false"\n      matInput\n      [formControl]="searchControl"\n      #input\n      (blur)="blur()"\n      (focus)="input.select(); focus()"\n      [matAutocomplete]="auto">\n  <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayWith"\n    [autoActiveFirstOption]="autoActiveFirstOption"\n   class="bigger-mat-ac">\n    <mat-option *ngFor="let option of list | async"\n      [value]="option">\n      {{ option.display }}\n    </mat-option>\n  </mat-autocomplete>\n  <b>{{ errorMessage | async }}</b>\n</mat-form-field>\n',providers:[{provide:o.NG_VALUE_ACCESSOR,useExisting:e.forwardRef(function(){return i}),multi:!0}],encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[".bigger-mat-ac.mat-autocomplete-panel{max-height:500px!important}.obs-mat-container{position:relative}.obs-mat-container mat-spinner.obs-mat-spinner{position:absolute;right:5px}.obs-no-matches{position:absolute;color:silver;right:5px}.ng-invalid.ng-touched>.obs-mat-container,.ng-invalid.ng-touched>.obs-mat-container label{color:#f44336!important}"]})],n)}(h),d=function(){function t(){}return t=u([e.NgModule({imports:[n.CommonModule,i.MatAutocompleteModule,i.MatFormFieldModule,i.MatInputModule,i.MatProgressSpinnerModule,i.MatTooltipModule,o.FormsModule,o.ReactiveFormsModule],declarations:[f],exports:[f]})],t)}();t.SearchSelectBase=h,t.SearchSelectModule=d,t.Éµa=f,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=oasisdigital-angular-material-search-select.umd.min.js.map